<script lang="ts">
	import { onMount } from 'svelte';

	let shouldShowOptions = false;
	let theme: string;

	function setTheme(themeToSet: string): void {
		if (themeToSet === 'light') {
			document.documentElement.classList.remove('dark');
		}
		else if (themeToSet === 'dark') {
			document.documentElement.classList.add('dark');
		}
		else if(themeToSet === 'system') {
			window?.matchMedia('(prefers-color-scheme: dark)').matches
				? document.documentElement.classList.add('dark')
				: document.documentElement.classList.remove('dark');
		}
		else {
			setTheme('system');
			return;
		}
		theme = themeToSet;
		localStorage.setItem('theme', theme);
		document.documentElement.dispatchEvent(new CustomEvent('theme-change'));
	}
	function cycleTheme() {
		if(theme === 'light') setTheme('dark');
		else if(theme === 'dark') setTheme('system');
		else if(theme === 'system') setTheme('light');
		else setTheme('system');
	}

	onMount(() => {
		setTheme(
			localStorage.getItem('theme') ??
			(window?.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light')
		);
		window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
			if(theme === 'system') setTheme('system');
		});
	});
</script>

<div class="hidden lg:block">
	<button class="bnt" on:click={() => (shouldShowOptions = !shouldShowOptions)}>
		Theme
	</button>
	<div class="mt-2 absolute bottom-1/2 lg:bottom-auto left-0 lg:left-auto z-10 transition-all duration-500 h-0 overflow-hidden {shouldShowOptions? 'h-40':''}">
		<ul class="text-center divide-y text-button-text bg-button-bg p-2 rounded-lg w-24">
			<li
				class="bnt !rounded-none !mx-0 !w-full"
				on:click={() => {
					setTheme('light');
					shouldShowOptions = false;
				}}
			>
				Light
			</li>
			<li
				class="bnt !rounded-none !mx-0 !w-full"
				on:click={() => {
					setTheme('dark');
					shouldShowOptions = false;
				}}
			>
				Dark
			</li>
			<li
				class="bnt !rounded-none !mx-0 !w-full"
				on:click={() => {
					setTheme('system');
					shouldShowOptions = false;
				}}
			>
				System
			</li>
		</ul>
	</div>
</div>
<div class="lg:hidden">
	<button on:click="{cycleTheme}">
		{#if theme === 'light'}
			<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
				<circle cx="12.0385" cy="11.9614" r="4.85695" fill="#B8B8B8"/>
				<path d="M11.597 1.32135V3.25097C11.597 3.42842 11.7408 3.57227 11.9183 3.57227C12.0957 3.57227 12.2396 3.42842 12.2396 3.25097V1.32135C12.2396 1.1439 12.0957 1.00006 11.9183 1.00006C11.7408 1.00006 11.597 1.1439 11.597 1.32135Z" fill="#B8B8B8"/>
				<path d="M11.597 20.7491V22.6787C11.597 22.8562 11.7408 23 11.9183 23C12.0957 23 12.2396 22.8562 12.2396 22.6787V20.7491C12.2396 20.5716 12.0957 20.4278 11.9183 20.4278C11.7408 20.4278 11.597 20.5716 11.597 20.7491Z" fill="#B8B8B8"/>
				<path d="M22.6787 11.52H20.7491C20.5716 11.52 20.4278 11.6639 20.4278 11.8413C20.4278 12.0188 20.5716 12.1626 20.7491 12.1626H22.6787C22.8562 12.1626 23 12.0188 23 11.8413C23 11.6639 22.8562 11.52 22.6787 11.52Z" fill="#B8B8B8"/>
				<path d="M21.8342 7.58345L20.052 8.32167C19.8879 8.38962 19.81 8.57769 19.878 8.74174C19.9459 8.90579 20.134 8.98369 20.2981 8.91574L22.0803 8.17752C22.2443 8.10957 22.3222 7.92149 22.2543 7.75745C22.1863 7.5934 21.9982 7.51549 21.8342 7.58345Z" fill="#B8B8B8"/>
				<path d="M16.2219 2.07724L15.4836 3.85946C15.4157 4.02351 15.4936 4.21158 15.6576 4.27953C15.8217 4.34748 16.0098 4.26958 16.0777 4.10553L16.8159 2.32331C16.8839 2.15926 16.806 1.97119 16.6419 1.90324C16.4779 1.83529 16.2898 1.91319 16.2219 2.07724Z" fill="#B8B8B8"/>
				<path d="M16.8161 21.5426L16.0779 19.7604C16.0099 19.5964 15.8218 19.5185 15.6578 19.5864C15.4937 19.6544 15.4158 19.8424 15.4838 20.0065L16.222 21.7887C16.29 21.9528 16.478 22.0307 16.6421 21.9627C16.8061 21.8948 16.884 21.7067 16.8161 21.5426Z" fill="#B8B8B8"/>
				<path d="M8.67119 3.85953L7.93297 2.07731C7.86502 1.91326 7.67695 1.83536 7.5129 1.90331C7.34885 1.97126 7.27095 2.15933 7.3389 2.32338L8.07712 4.1056C8.14507 4.26965 8.33314 4.34756 8.49719 4.2796C8.66124 4.21165 8.73914 4.02358 8.67119 3.85953Z" fill="#B8B8B8"/>
				<path d="M8.18438 19.8676L7.44616 21.6499C7.37821 21.8139 7.45611 22.002 7.62016 22.0699C7.78421 22.1379 7.97228 22.06 8.04023 21.8959L8.77845 20.1137C8.8464 19.9497 8.7685 19.7616 8.60445 19.6936C8.4404 19.6257 8.25233 19.7036 8.18438 19.8676Z" fill="#B8B8B8"/>
				<path d="M2.15432 8.17732L3.93654 8.91554C4.10059 8.98349 4.28867 8.90559 4.35662 8.74154C4.42457 8.57749 4.34667 8.38942 4.18262 8.32146L2.4004 7.58324C2.23635 7.51529 2.04828 7.5932 1.98032 7.75724C1.91237 7.92129 1.99028 8.10937 2.15432 8.17732Z" fill="#B8B8B8"/>
				<path d="M2.40048 16.4177L4.1827 15.6794C4.34675 15.6115 4.42465 15.4234 4.3567 15.2594C4.28875 15.0953 4.10068 15.0174 3.93663 15.0854L2.15441 15.8236C1.99036 15.8915 1.91246 16.0796 1.98041 16.2437C2.04836 16.4077 2.23643 16.4856 2.40048 16.4177Z" fill="#B8B8B8"/>
				<path d="M22.0801 15.8235L20.2979 15.0853C20.1338 15.0174 19.9458 15.0953 19.8778 15.2593C19.8099 15.4234 19.8878 15.6114 20.0518 15.6794L21.834 16.4176C21.9981 16.4856 22.1862 16.4077 22.2541 16.2436C22.3221 16.0796 22.2442 15.8915 22.0801 15.8235Z" fill="#B8B8B8"/>
				<path d="M3.25092 11.52H1.32129C1.14385 11.52 1 11.6639 1 11.8413C1 12.0188 1.14385 12.1626 1.32129 12.1626H3.25092C3.42836 12.1626 3.57221 12.0188 3.57221 11.8413C3.57221 11.6639 3.42836 11.52 3.25092 11.52Z" fill="#B8B8B8"/>
				<path d="M5.59213 17.976L4.22807 19.34C4.10252 19.4656 4.10252 19.6692 4.22807 19.7947C4.35363 19.9203 4.5572 19.9203 4.68276 19.7947L6.04681 18.4307C6.17237 18.3051 6.17237 18.1015 6.04681 17.976C5.92125 17.8504 5.71768 17.8504 5.59213 17.976Z" fill="#B8B8B8"/>
				<path d="M19.417 4.15116L18.053 5.51521C17.9274 5.64077 17.9274 5.84434 18.053 5.9699C18.1785 6.09545 18.3821 6.09545 18.5076 5.9699L19.8717 4.60584C19.9973 4.48029 19.9973 4.27672 19.8717 4.15116C19.7461 4.0256 19.5426 4.0256 19.417 4.15116Z" fill="#B8B8B8"/>
				<path d="M18.0531 18.4307L19.4171 19.7948C19.5427 19.9203 19.7463 19.9203 19.8718 19.7948C19.9974 19.6692 19.9974 19.4656 19.8718 19.3401L18.5078 17.976C18.3822 17.8505 18.1786 17.8505 18.0531 17.976C17.9275 18.1016 17.9275 18.3051 18.0531 18.4307Z" fill="#B8B8B8"/>
				<path d="M4.22819 4.60587L5.59224 5.96992C5.7178 6.09548 5.92136 6.09548 6.04692 5.96992C6.17248 5.84437 6.17248 5.6408 6.04692 5.51524L4.68287 4.15119C4.55731 4.02563 4.35374 4.02563 4.22819 4.15119C4.10263 4.27674 4.10263 4.48031 4.22819 4.60587Z" fill="#B8B8B8"/>
			</svg>
		{:else if theme === 'dark'}
			<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
				<path d="M1 12C1 18.0751 5.95826 23 12.0746 23C17.5703 23 22.1311 19.0238 23 13.8097C23 13.8097 21.2103 16.9845 17.5972 17.7987C11.6132 19.1471 8.39537 14.4277 8.39537 14.4277C8.39537 14.4277 5.06463 9.93307 8.22601 4.87661C10.71 1.39328 13.9278 1.15333 13.9278 1.15333C13.3252 1.0525 12.7061 1 12.0746 1C5.95826 1 1 5.92487 1 12Z" fill="#C4C4C4"/>
			</svg>
		{:else}
			<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
				<path d="M5.13684 4H18.6236C18.8997 4 19.1236 4.22386 19.1236 4.5V12.5C19.1236 12.7761 18.8997 13 18.6236 13H5.13684C4.8607 13 4.63684 12.7761 4.63684 12.5V4.5C4.63684 4.22386 4.8607 4 5.13684 4Z" stroke="#C4C4C4" stroke-width="2" stroke-linejoin="round"/>
				<path d="M3.79045 15.5354L0.903335 18.1723C0.229271 18.788 0.664824 19.9107 1.57772 19.9107L22.1828 19.9107C23.0957 19.9107 23.5313 18.788 22.8572 18.1723L19.9701 15.5354C19.7858 15.3671 19.5453 15.2738 19.2957 15.2738H4.46484C4.21527 15.2738 3.97473 15.3671 3.79045 15.5354Z" fill="#C4C4C4"/>
			</svg>
		{/if}
	</button>
</div>
